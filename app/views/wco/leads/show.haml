
.leads-show.padded

  .header
    %h2.title
      Lead ##{@lead.id}
      = link_to '[~]', edit_lead_path(@lead)

  .row
    .col-md-6
      %ul
        %li Name: #{@lead.name}
        %li Email: #{@lead.email}
        %li
          Leadset: #{ link_to @lead.leadset.company_url, leadset_path(@lead.leadset) }
        -# %li Rating: #{@lead.rating}
        - if @lead.phone
          %li Phone: #{@lead.phone}
        - if @lead.address
          %li Address: #{@lead.address}
        -# - if @lead.comment
        -#   %li Comment: #{raw @lead.comment}
        - if @lead.photo
          %li
            = image_tag Photo.find( @lead.photo_id ).photo.url(:small)

    .col-md-6
      %h5 Tags
      %ul
        - @lead.tags.each do |tag|
          %li
            = link_to tag.name, tag_path(tag)

  .row
    .col-md-6.ctxs
      %h5
        Email Contexts (#{@lead.ctxs.length})
        = link_to '[+]', '#'
      %ul
        = paginate @ctxs, param_name: :ctxs_page
        - @ctxs.each do |ctx|
          %li
            = pp_date( ctx.sent_at ) || 'not sent'
            = link_to ctx.subject.presence||"No Subj?!", wco_email.context_path(ctx)
        = paginate @ctxs, param_name: :ctxs_page

    .col-md-6.schs
      %h5
        Email Actions (#{@lead.schs.length})
        = link_to '[+]', wco_email.new_email_action_path(lead_id: @lead.id)
      %ul
        - @lead.schs.each do |sch|
          %li
            = link_to sch, wco_email.edit_email_action_path(sch)
            = sch.status
            %br
            (#{link_to sch.email_action_template, wco_email.edit_email_action_template_path(sch.email_action_template)})
            Perform at: #{pp_datetime sch.perform_at}

      %hr
      %h5
        Invoices (?)
        = link_to '[+stripe]', new_invoice_stripe_path({ leadset_id: @lead.leadset_id })
        = link_to '[+pdf]', new_invoice_pdf_path({ leadset_id: @lead.leadset_id })
      %ul
        %li None?



  .row
    .col-md-12.conversations
      %h5 Email Conversations (#{@convs.length})
      = paginate @convs, param_name: :convs_page
      = render 'wco_email/conversations/table', convs: @convs
      = paginate @convs, param_name: :convs_page

