#!/bin/bash

if ssh-add -L | grep macpc ; then
  echo ok # nothing
else
  ssh-add ~/.ssh/mac_id_rsa_2
fi

set -ex

./scripts/version_bump
version=`cat VERSION`
cat wco_models.gemspec-template | \
  sed -e "s/\$version/$version/g" > wco_models.gemspec

bundle

git add .
git commit -m 'autobuild `date "+%Y%m%d"`'
git push

gem build wco_models.gemspec
gem push wco_models-$version.gem

rm wco_models-`cat VERSION`.gem

echo "wco_models build ok"
